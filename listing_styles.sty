\makeatletter
\@ifpackageloaded{listings}{%
	% source code formatting (CAUTION: listings != listing package)

	% Default fixed font does not support bold face
	\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{8} % for bold
	\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

	% Custom colors
	\usepackage{color}
	\definecolor{deepblue}{rgb}{0,0,0.5}
	\definecolor{deepred}{rgb}{0.6,0,0}
	\definecolor{deepgreen}{rgb}{0,0.5,0}

	\newfontfamily{\couriernew}{Courier New}

	\newcommand\cstyle{\lstset{%
		language=C,% choose the language of the code
		basicstyle=\footnotesize,% the size of the fonts that are used for the code
		numbers=left,% where to put the line-numbers
		numberstyle=\footnotesize,% the size of the fonts that are used for the line-numbers
		stepnumber=2,% the step between two line-numbers. If it's 1 each line will be numbered
		numbersep=5pt,% how far the line-numbers are from the code
		backgroundcolor=\color{white},% choose the background color. You must add \usepackage{color}
		showspaces=false,% show spaces adding particular underscores
		showstringspaces=false,% underline spaces within strings
		showtabs=false,% show tabs within strings adding particular underscores
		%frame=single,% adds a frame around the code
		tabsize=4,% sets default tabsize to 2 spaces
		captionpos=b,% sets the caption-position to bottom
		breaklines=true,% sets automatic line breaking
		breakatwhitespace=false,% sets if automatic breaks should only happen at whitespace
		title=\lstname,% show the filename of files included with \lstinputlisting; also try caption instead of title
		escapeinside={\%*}{*)},% if you want to add a comment within your code
		frame=shadowbox,%
		rulesepcolor=\color{blue},%
		keywordstyle=\color[rgb]{0,0,1},%
		commentstyle=\color[rgb]{0.133,0.545,0.133},%
		stringstyle=\color[rgb]{0.627,0.126,0.941}%
	}}%

	\newcommand\pythonstyle{\lstset{%
		language=Python,%
		basicstyle=\footnotesize\couriernew,%
		numbers=left,%
		numberstyle=\footnotesize,%
		stepnumber=1,%
		numbersep=5pt,%
		backgroundcolor=\color{white},%
		showspaces=false,%
		showstringspaces=false,%
		showtabs=false,%
		%frame=single,%
		otherkeywords={self},%
		keywordstyle=\ttb\color{deepblue},%
		commentstyle=\color[rgb]{0.133,0.545,0.133},%
		stringstyle=\color[rgb]{0.627,0.126,0.941},%
		%
		emph={MyClass,__init__},%
		emphstyle=\ttb\color{deepred},%
		stringstyle=\color{deepgreen},%
		frame=tb,%
		showstringspaces=false%
		%
		tabsize=4,% sets default tabsize to 2 spaces
		captionpos=b,% sets the caption-position to bottom
		breaklines=true,% sets automatic line breaking
		breakatwhitespace=false,% sets if automatic breaks should only happen at whitespace
		%title=\lstname,% show the filename of files included with \lstinputlisting; also try caption instead of title
		escapeinside={\%*}{*)},%
		frame=shadowbox,%
		rulesepcolor=\color{blue},%
	}}%

	\newcommand\promelastyle{\lstset{%
		language=Promela,%
		basicstyle=\footnotesize\couriernew,%
		numbers=left,%
		numberstyle=\footnotesize,%
		stepnumber=1,%
		numbersep=5pt,%
		backgroundcolor=\color{white},%
		showspaces=false,%
		showstringspaces=false,%
		showtabs=false,%
		%frame=single,%
		otherkeywords={self},%
		keywordstyle=\ttb\color{deepblue},%
		commentstyle=\color[rgb]{0.133,0.545,0.133},%
		stringstyle=\color[rgb]{0.627,0.126,0.941},%
		stringstyle=\color{deepgreen},%
		frame=tb,%
		showstringspaces=false%
		%
		tabsize=4,%
		captionpos=b,%
		breaklines=true,%
		breakatwhitespace=false,%
		%title=\lstname,%
		escapeinside={\%*}{*)},%
		frame=shadowbox,%
		rulesepcolor=\color{blue},%
	}}%

	\newcommand{\matlabstyle}{
		%
	}%

	% Python for external files
	\newcommand\inputcode[2][\undefined]{%
		\ifx#1c%
			\cstyle%
		\fi%
		\ifx#1promela%
			\promelastyle%
		\fi%
		\ifx#1python%
			\pythonstyle%
		\fi%
		\ifx#1matlab%
			\matlabstyle%
		\fi%
		\lstinputlisting{#2}%
	}%
}{%
	%skip
}%
\makeatother
